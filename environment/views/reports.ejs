<!DOCTYPE html>
<html>
<title>RetinoDoc</title>
<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src='https://kit.fontawesome.com/a076d05399.js'></script>
<!--screenshot-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script type="text/javascript" src="jszip/dist/jszip.js"></script>
    <script type="text/javascript" src="https://stuk.github.io/jszip-utils/dist/jszip-utils.js"></script>
    <script src='https://code.jquery.com/jquery-2.2.4.min.js'></script>
    <script src="js/download.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />

<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js" integrity="sha256-c3RzsUWg+y2XljunEQS0LqWdQ04X1D3j22fd/8JCAKw=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js" integrity="sha256-FPJJt8nA+xL4RU6/gsriA8p8xAeLGatoyTjldvQKGdE=" crossorigin="anonymous"></script>
<style>
.button5 {
  background-color: white;
  color: black;
  border: 2px solid #555555;

}
.hd{
  text-align:center;
  
}
.he{
  text-align:center;
}
.button {
  background-color: black; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  padding-left:50px;
  padding-right:50px;
  height:50px;
  width:150px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
 
}
/*screenshot*/
#result-image {
  height:auto;
  max-width:100%;
}

html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif}
</style>
<body class="w3-light-grey">

<!-- Page Container -->
<div class="w3-content w3-margin-top" style="max-width:1400px;">

  <!-- The Grid -->
  <div class="w3-row-padding">
  
    <!-- Left Column -->
    <div class="w3-third" style="width:400px; height:1400px;">
    
      <div class="w3-white w3-text-grey w3-card-4">
        <div class="w3-display-container">
          <img src="https://approachschoolofmotoring.co.uk/wp/wp-content/uploads/2019/01/profile-plain-300x278.png" style="width:100%; height:320px;" alt="Avatar">
          <div class="w3-display-bottomleft w3-container w3-text-black">
            
          </div>
        </div>
        <div class="w3-container">
                      <p><i class="fa fa-address-card fa-fw w3-margin-right w3-large w3-text-black"></i>Name: <%=currentUser.name%></p>
          <p><i class="fa fa-phone fa-fw w3-margin-right w3-large w3-text-black"></i>Contact: <%=currentUser.number%></p>
          
          <p><i class="fa fa-envelope fa-fw w3-margin-right w3-large w3-text-black"></i>Email: <%=currentUser.email%></p>
          
          <hr>

          <p class="w3-large"><b><i class="fa fa-asterisk fa-fw w3-margin-right w3-text-black"></i>Diabetic Retinopathy Levels</b></p>
          <p>Level 0: No DR</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:0%">0%</div>
          </div>
          <p>Level 1: Mild Non-Proliferative DR</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:25%">
              <div class="w3-center w3-text-white">25%</div>
            </div>
          </div>
          <p>Level 2: Moderate Non-Proliferative DR</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:50%">50%</div>
          </div>
          <p>Level 3: Severe Non-Proliferative DR</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:75%">75%</div>
          </div>
          <p>Level 4: Proliferative DR</p>
          <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:100%">100%</div>
          </div>
          <br>
          

          <p class="w3-large w3-text-theme"><b><i class="fa fa-globe fa-fw w3-margin-right w3-text-black"></i>Features Extracted</b></p>
          <p>Exudates</p>
          <div class="w3-light-grey w3-round-xlarge">
            <!--<div class="w3-round-xlarge w3-teal" style="height:24px;width:100%"></div>-->
            <p>These are mass of cells or fluid that have seeped out as a result of the disruption in retinal blood vessels and are visible as bright regions.</p>
          </div>
          <p>Blood Vessels</p>
          <div class="w3-light-grey w3-round-xlarge">
            <!--<div class="w3-round-xlarge w3-teal" style="height:24px;width:55%"></div>-->
            <p>These are the blood vessels in the retina that are affected as a result of conditions and these cover a larger area.</p>
          </div>
          <p>Microaneuryms</p>
          <div class="w3-light-grey w3-round-xlarge">
            <!--<div class="w3-round-xlarge w3-teal" style="height:24px;width:25%"></div>-->
            <p>These are small blobs or dots in the retina and are the first signs generally sometimes rarely visible in later stages.</p>
          </div>
          <br>
        </div>
        <div class="he">
        <button class="button button5" style="width:300px; height:50px; background-color:black; font-size:20px; border-radius:4px;border: none;padding: 12px 16px;color:white;"><a href="/userprofile/<%= currentUser._id %>"><i class="material-icons" style="font-size:20px">&#xe5c4;</i> Back</a></button>
        </div>
        <div class="hd">
    <!--<button id="btnSave" class="button button5" onclick="download()">Download</button>-->
    <button class="button button5" style="width:300px; height:50px; background-color:black; font-size:20px; border-radius:4px;border: none;padding: 12px 16px;color:white;"><a href="javascript:;" onclick="LatestPost();" ><i class='fas fa-file-download' style='font-size:20px'></i> Download Report</a></button>
    <!--<a href="javascript:;" onclick="LatestPost();" class="btn btn-info">Take Latest Post Box</a>-->
    <!--<a href="javascript:;" onclick="wholePage();" class="btn btn-success">Take Whole Page</a>-->
    </div>
      </div><br>

    <!-- End Left Column -->
    </div>

    <!-- Right Column -->
    <!--screenshot needs to be taken-->
    <div class="w3-twothird" style="height:2000px;" id="LatestPost">
    
      <div class="w3-container w3-card w3-white w3-margin-bottom">
        <h2 class="w3-text-black w3-padding-16"><i class="fa fa-suitcase fa-fw w3-margin-right w3-xxlarge w3-text-black"></i>Report generated on <%= result.datet %></h2>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>Patients Username: <%= result.author.username %></b></h5>
          <h6 class="w3-text-black">Report Details:</h6>
          <p>The Report Generated below is the level of Diabetic Retinopathy of the uploaded Retinal Image of the patient.</p>
          <p>If the patient is diagnosed as higher levels of retinopathy then the patient is provided with the extent to which the regions is affected as well as appropriate suggestions for treatment.</p>
          <hr>
        </div>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>You Have Diabetic Retinopathy of Level <%= result.level %></b></h5>
            <%if(result.level==0){%>
            <div class="w3-light-grey w3-round-xlarge w3-small">
                 <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:0%">0%</div>
                          </div>                          
                                  <% }%>
                                   <%if(result.level==1){%>
                                   <div class="w3-light-grey w3-round-xlarge w3-small">
                 <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:25%">25%</div>
                                       </div>             
                                  <% }%>
                                   <%if(result.level==2){%>
                                   <div class="w3-light-grey w3-round-xlarge w3-small">
                 <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:50%">50%</div>
                                         </div>           
                                  <% }%>
                                   <%if(result.level==3){%>
 <div class="w3-light-grey w3-round-xlarge w3-small">
            <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:75%">75%</div>
          </div>                     
                                  <% }%>
                                   <%if(result.level==4){%>
                                   <div class="w3-light-grey w3-round-xlarge w3-small">
                 <div class="w3-container w3-center w3-round-xlarge w3-black" style="width:100%">100%</div>
                                                 </div>   
                                  <% }%>
                                  
          <h6 class="w3-text-black">Test Results:</h6>
          <!--<p>Consectetur adipisicing elit. Praesentium magnam consectetur vel in deserunt aspernatur est reprehenderit sunt hic. Nulla tempora soluta ea et odio, unde doloremque repellendus iure, iste.</p>-->
            <%if(result.level==0){%>
                  <p>The test detects no defect, but if you are a diabetic you are advised to test yourself every six months.</p>
                  <br>
                                                    
                                  <% } else {%>
                           <p>Exudates: <%= result.exudatess %></p>
                           <p>Bloodvessels: <%= result.bloodvess %></p>
                           <p>Microaneurysms: <%= result.microaneus %></p>
          <hr>
        </div>
        <div class="w3-container">
          <h5 class="w3-opacity"><b>Based on the above Results</b></h5>
          <h4 class="w3-text-black">Treatment Suggestions:</h4>
            <% } %>
                   
                                                    <%if(result.exudatess=='are present' && result.level!=0){%>  
                                                    <p><i style="font-size:15px" class="fa">&#xf0f1;</i> The treatment options for are:</p>
                                                    <ul>
                                                      <li><b>Surgical Excision of Hard Exudates</b></li>
                                                      <p>Surgical Excision of Hard Exudates is performed to remove the vitreous body, and also consists of an important procedure called retinotomy, along with a gentle washout.</p>
                                                      <p>It is our recommendation that it is appropriate to proceed with submacular surgery when exudates begin to accumulate under the fovea. </p>
                                                    </ul>
                           <% } %>
                           
                                                    <%if(result.bloodvess=='are present' && result.level!=0){%>
                                 <p><i style="font-size:15px" class="fa">&#xf0f1;</i> The treatment options are:</p>
                                                    <p><ul>
                                                      <li><b>Anti-VEGF (Vascular Endothelial Growth Factor) or an Anti-Inflammatory Medicine</b></li>
                                                      <p>Anti-VEGF medicines slows down the growth of abnormal blood vessels in the retina. Anti-VEGF medicines block the effects of vascular endothelial growth factor (VEGF), a portein which triggers the growth of new blood vessels. Progression of DR can be slowed down in 25–30% of eyes treated for two years with the usage of anti-VEGF medications.</p>
                                                      <li><b>Scatter Laser Surgery (Pan-Retinal Photocoagulation)</b></li>
                                                      <p>It can facilitate treatment of advanced cases of Diabetic Retinopathy. The doctor uses lasers to shrink blood vessels within the eye that are causing vision issues.</p>
                                                    </ul></p>
                          <% } %>
                                                                               <%if(result.microaneus=='are present' && result.level==1){%>  
                                                  <p><i style="font-size:15px" class="fa">&#xf0f1;</i> The treatment options are:</p>
                                                                 <ul>
                                                      <li><b>You must visit your eye doctor as well as your general physician who will check on your retinopathy as well as prescribe tests for your diabetes, blood pressure if not diagnosed as yet.</b></li>
                                                      <li><b>If diagnosed then visit your opthalmologist who will presrcibe eye drops or eye injections or appropriate steroid medication such as Anti VEGF or ranizamb. Th side effects of the injections and the medication include headache, watery eyes, blurred vision for a day or two.You are advised to visit the doctor if the problem persists.</b></li>
                                                      <li><b>Your diabetic Retinopathy is of a lower level but needs to be monitored hence you are advised to get you retina tested as often as every 6-12 months.</b></li>
                         
                         </ul>
                           <% } %>
                                                                                             <%if(result.microaneus=='are present' && result.level==2){%>  
                                                   
                                                       <p><i style="font-size:15px" class="fa">&#xf0f1;</i> The treatment options are:</p>
                                                          <ul>
                                                       <li><b>You must visit your eye doctor as well as your general physician who will check on your retinopathy as well as prescribe tests for your diabetes, blood pressure if not diagnosed as yet.</b></li>
                                                       <li><b>Laser ablation </b></li>
                                                       <p>Laser photocoagulation: It uses the heat from a laser to seal or destroy abnormal, leaking blood vessels in the retina. One of two approaches may be used when treating diabetic retinopathy.</p>
                                                       <p>Focal photocoagulation: Focal treatment is used to seal specific leaking blood vessels in a small area of the retina, usually near the macula. The ophthalmologist identifies individual blood vessels for treatment and makes a limited number of laser burns to seal them off.</p>
                                            
                                                       <li><b>Your diabetic Retinopathy is at a higher level of severity but needs to be monitored hence you are advised to get you retina tested as often as every 3-6 months.</b></li>
</ul></ul>
                           <% } %>
                                                                                         <%if(result.microaneus=='are present' &&( result.level==3 || result.level==4)){%>  
                                                        
                                                <p><i style="font-size:15px" class="fa">&#xf0f1;</i> The treatment options are:</p>
                                                  <ul> 
                                                       <li><b>You must visit your eye doctor as well as your general physician who will check on your retinopathy as well as prescribe tests for your diabetes, blood pressure if not diagnosed as yet.</b></li>
                                                       <li><b>Your diabetic Retinopathy is at a highest levels of severity but needs to be monitored hence you are advised to get you retina tested as often as every 1-2 months.</b></li>
                                   
                                                       <li><b>Laser ablation </b></li>
                                                       <p>Laser photocoagulation: It uses the heat from a laser to seal or destroy abnormal, leaking blood vessels in the retina. One of two approaches may be used when treating diabetic retinopathy.</p>
                                                       <p>Focal photocoagulation: Focal treatment is used to seal specific leaking blood vessels in a small area of the retina, usually near the macula. The ophthalmologist identifies individual blood vessels for treatment and makes a limited number of laser burns to seal them off.</p>
                           
                                                       <li><b>Vitreoctomy</b></li>
                                                       <p>Vitrectomy is a surgical procedure undertaken by a specialist where the vitreous humor gel that fills the eye cavity is removed to provide better access to the retina. This allows for a variety of repairs, including the removal of scar tissue, laser repair of retinal detachments and treatment of macular holes. Once surgery is complete, saline, a gas bubble or silicone oil may be injected into the vitreous gel to help hold the retina in position.</p>
                                                  </ul>
                                    
                          <br>
                          <br>
                           <% } %>
         
          <br>
        </div>
      </div>
<%if(result.level!=0){%>
      <div class="w3-container w3-card w3-white">
        
        <h2 class="w3-text-grey w3-padding-16"><i class="fa fa-certificate fa-fw w3-margin-right w3-xxlarge w3-text-black"></i>Result Statistics</h2>
          <div class="w3-row w3-container">

 <!-- <div class="w3-col s4 " >-->
   <div id="chartContainer" style="height: 300px; width: 100%;"></div>
 <!-- </div>-->
 <!-- <div class="w3-col s4 ">-->
 <!--  <div id="chartContainers" style="height: 300px; width: 100%;"></div>-->
 <!-- </div>-->
 <!-- <div class="w3-col s4 ">-->
 <!--<div id="chartContainer" style="height: 300px; width: 100%;"></div>-->
 <!-- </div>-->
</div>

<div class="w3-row w3-container">
       <div id="chartContainers" style="height: 300px; width: 100%;"></div>
    </div>
    
<div class="w3-row w3-container">
       <div id="chartContainerss" style="height: 300px; width: 100%;"></div>
    </div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
      </div>

    <!-- End Right Column -->
    </div>
   
    <!--screenshot ends here-->
    
  <!-- End Grid -->
  </div>
    <% } %>
  <br>
  <br>
  <br>
  <!-- End Page Container -->
</div>


<!--<footer class="w3-container w3-teal w3-center w3-margin-top">-->
<!--  <p>Find me on social media.</p>-->
<!--  <i class="fa fa-facebook-official w3-hover-opacity"></i>-->
<!--  <i class="fa fa-instagram w3-hover-opacity"></i>-->
<!--  <i class="fa fa-snapchat w3-hover-opacity"></i>-->
<!--  <i class="fa fa-pinterest-p w3-hover-opacity"></i>-->
<!--  <i class="fa fa-twitter w3-hover-opacity"></i>-->
<!--  <i class="fa fa-linkedin w3-hover-opacity"></i>-->
<!--  <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>-->
<!--</footer>-->
<script>

window.onload = function () {
var cf=parseInt(<%= result.bldnes %>)
var cn=cf*100;
var cq=cn/1344783;
var ce=parseInt(<%= result.microses %>)
var cd=parseInt(<%= result.exunes %>)
var ci=cd*100
var cj=ci/39000
var ch=ce*100
var cz=ch/163
var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	title:{
		text: "Blood Vessels",
		horizontalAlign: "left"
	},
	data: [{
		type: "doughnut",
		startAngle: 60,
		//innerRadius: 60,
		indexLabelFontSize: 17,
		indexLabel: "{label} #percent%",
		toolTipContent: "<b>{label}:</b> {y} (#percent%)",
		dataPoints: [
			{ y:100-cq,label:"Unaffected" },
			{ y: cq, label: "Affected" },
		
		]
	}]
});
chart.render();
var chart = new CanvasJS.Chart("chartContainers", {
	animationEnabled: true,
	title:{
		text: "Microaneuryms",
		horizontalAlign: "left"
	},
	data: [{
		type: "doughnut",
		startAngle: 60,
		//innerRadius: 60,
		indexLabelFontSize: 17,
		indexLabel: "{label} #percent%",
		toolTipContent: "<b>{label}:</b> {y} (#percent%)",
		dataPoints: [
			{ y:100-cz,label:"Unaffected" },
			{ y: cz, label: "Affected" },
		
		]
	}]
});
chart.render();
var chart = new CanvasJS.Chart("chartContainerss", {
	animationEnabled: true,
	title:{
		text: "Exudates",
		horizontalAlign: "left"
	},
	data: [{
		type: "doughnut",
		startAngle: 60,
		//innerRadius: 60,
		indexLabelFontSize: 17,
		indexLabel: "{label} #percent%",
		toolTipContent: "<b>{label}:</b> {y} (#percent%)",
		dataPoints: [
			{ y:100-cj,label:"Unaffected" },
			{ y: cj, label: "Affected" },
		
		]
	}]
});
chart.render();
}


</script>
<script type="text/javascript">

function wholePage()
{
  html2canvas(document.body, {
      onrendered: function(canvas)  
      {
        var img = canvas.toDataURL();
        $("#result-image").attr('src', img).show();

        canvas.toBlob(function(blob) {
          saveAs(blob, "Report1.png");
        });
      }
  });
  return false;
}

function LatestPost()
{
  html2canvas(document.querySelector("#LatestPost"), {
      onrendered: function(canvas)  
      {
        var img = canvas.toDataURL();
        $("#result-image").attr('src', img).show();
        canvas.toBlob(function(blob) {
          saveAs(blob, "Report.png");
        });
      },
      allowTaint: true,
      imageTimeout: 0,
      useCORS: true
  });
  return false;
}

</script>   
</body>
</html>