<!DOCTYPE html>
<html>
<title>RetinoDoc</title>
<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon">
<head>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.7"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!--userprofile.ejs-->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.7"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <style>
      body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif;}
    
    body, html {
        height: 100%;
        color: #777;
        line-height: 1.8;
    
    }
    /* Create a Parallax Effect */
    .bgimg-6{
        background-attachment: fixed;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
    }
    .portfolio{
      margin: auto;
    }
    .title {
      color: grey;
      font-size: 18px;
    }
    
    button {
      border: none;
      outline: 0;
      display: inline-block;
      padding: 8px;
      color: white;
      background-color: #000;
      text-align: center;
      cursor: pointer;
      width: 100%;
      font-size: 18px;
    }
    
    a {
      text-decoration: none;
      font-size: 22px;
      color: black;
    }
    
    .bgimg-6{
        background-image: url("https://www.aucelloeyecarecenter.com/wp-content/uploads/2016/02/imag4.jpg");
        min-height: 100px;
    }
    .w3-wide {letter-spacing: 10px;}
    .w3-hover-opacity {cursor: pointer;}
    </style>
</head>

<body>
    <div class="w3-sidebar w3-bar-block w3-card w3-animate-left" style="display:none" id="mySidebar">
  <button class="w3-bar-item w3-button w3-large"
  onclick="w3_close()">CLOSE &times;</button>
  <a href="/home/<%= currentUser.id %>" class="w3-bar-item w3-button">About Me <span class="glyphicon glyphicon-user"></span></a>
  <a href="/home/<%= currentUser.id %>/trial" class="w3-bar-item w3-button">Take Test <span class="glyphicon glyphicon-edit"></span></a>
  <a href="/userprofile/<%= currentUser.id %>" class="w3-bar-item w3-button">View Report <span class="glyphicon glyphicon-file"></span></a>
    <a href="/viewRehab"class="w3-bar-item w3-button">Treatment Centre <i class='fas fa-hospital-alt' style='font-size:24px'></i></a>
  <a href="/viewdoctor"class="w3-bar-item w3-button">Consult Doctor <i class='fas fa-user-md' style='font-size:24px'></i></a>
</div>
<div class="w3-top">

  <div class="w3-bar w3-white w3-card" id="myNavbar">
    <button id="openNav" style="width:50px" class="w3-bar-item w3-button w3-black w3-xlarge" onclick="w3_open()">&#9776;</button>
    <a href="/" class="w3-bar-item w3-button w3-wide"><img src="../../images/favicon.ico" class="ico" style="width:25px;height:25px;"><strong> RetinoDoc</strong></a>
    
    <div class="w3-right w3-hide-small">
        
            <div class="w3-dropdown-hover">
                <a href="#" class="w3-button w3-white"><span class="glyphicon glyphicon-th"></span> Menu </a>
                <div class="w3-dropdown-content w3-bar-block w3-card-4">
                    <a href="/addict" class="w3-bar-item w3-button">Symptoms and Causes</a>
    <a href="/aboutUs" class="w3-bar-item w3-button">About Us</a>
                    <% if (!currentUser) { %>   
                    <a href="/login" class="w3-bar-item w3-button">Login for profile</a>
            
                     <% } else { %>
                    <a href="/home/<%= currentUser.id %>" class="w3-bar-item w3-button">View Profile of <%= currentUser.username %> </a>
             
                    <% } %>
                    
                </div>
            </div>
            <% if (!currentUser) { %>   
                <a href="/login" class="w3-bar-item w3-button"> Login</a>
            
                <a href="/signIn" class="w3-bar-item w3-button"><i class="fa fa-user"></i> Sign Up</a>
            <% } else { %>
                <a href="#" class="w3-bar-item w3-button"><i style='font-size:24px' class='fas'>&#xf2bd;</i> Logged In As <%= currentUser.username %> </a>
                <a href="/logout" class="w3-bar-item w3-button"><span class="glyphicon glyphicon-off"></span> Logout </a>
            <% } %>
    </div>
    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open1()">
      <i class="fa fa-bars"></i>
    </a>
  </div>
</div>

<nav class="w3-sidebar w3-bar-block w3-black w3-card w3-animate-left w3-hide-medium w3-hide-large" style="display:none; opacity:0.8" id="mySidebar1">

  <a href="javascript:void(0)" onclick="w3_close1()" class="w3-bar-item w3-button w3-large w3-padding-16">Close Ã—</a>

            <div class="w3-dropdown-hover">
                <a class="w3-button"><span class="glyphicon glyphicon-th"></span> Menu</a>
               <div class="w3-dropdown-content w3-bar-block w3-black w3-card-4">
                    <a href="/addict" class="w3-bar-item w3-button">Symptoms and Causes</a>
                    <a href="/aboutUs" class="w3-bar-item w3-button">About Us</a>
                     <% if (!currentUser) { %>   
                    <a href="/login" class="w3-bar-item w3-button">Login for profile</a>
            
                     <% } else { %>
                    <a href="/home/<%= currentUser.id %>" class="w3-bar-item w3-button">View Profile of <%= currentUser.username %> </a>
             
                    <% } %>
                </div>
            </div>  
     <% if (!currentUser) { %>   
                <a href="/login" class="w3-bar-item w3-button"><span class="glyphicon glyphicon-log-in"></span> Login</a>
            
                <a href="/signIn" class="w3-bar-item w3-button"><i class="fa fa-user-plus" style="font-size:20px"></i> Sign Up</a>
            <% } else { %>
                <a href="#" class="w3-bar-item w3-button"><i style='font-size:24px' class='fas'>&#xf2bd;</i> Logged In As <%= currentUser.username %> </a>
                <a href="/logout" class="w3-bar-item w3-button"><span class="glyphicon glyphicon-off"></span> Logout </a>
            <% } %>
</nav>

<script>
    var mySidebar1 = document.getElementById("mySidebar1");

function w3_open1() {
    if (mySidebar1.style.display === 'block') {
        mySidebar1.style.display = 'none';
    } else {
        mySidebar1.style.display = 'block';
    }
}

// Close the sidebar with the close button
function w3_close1() {
    mySidebar1.style.display = "none";
}
</script>

<!--<include partials/sideb %> -->
<br  id="home">
<br>
<div id="main">
    <div class="container-fluid p-3 my-3 border">
       
        <div class="card bg-dark text-white">
            <div class="card-body">
                <div class="card bg-light text-dark">
                    <div class="card-body">
                        <div class="row">
                            <button type="button" class="btn btn-dark" style=" height:50px; font-size:20px; border-radius:4px;border: none;padding: 12px 16px;color:white;" data-toggle="modal" data-target="#myModal"><i class='fas fa-file-alt'></i> Instructions to take the Test</button>

                              <!-- Modal -->
                              <div class="modal fade" id="myModal" role="dialog">
                                <div class="modal-dialog">
                                
                                  <!-- Modal content-->
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h4 class="modal-title"><i class='fas fa-file-alt'></i><strong> Intructions</strong></h4>
                                    </div>
                                    <div class="modal-body">
                                      <ul>
                                          <li>Upload the <strong>Retinal Scan Image</strong> by clicking on the <strong>Browse</strong> button</li>
                                          <li>Click on <strong>Predict Class</strong> to run the Test</li>
                                          <li>You will be redirected to your <strong>Profile Page</strong></li>
                                          <li>Click on <strong>View Report</strong> to see the <strong>Results</strong> of the Test</li>
                                      </ul>
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>
                                  </div>
                                  
                                </div>
                              </div>
                        </div>
                    </div>
                </div>
                <br>
                <div class="card bg-light text-dark">
                    <div class="card-body">
                        <form action="/home/<%=currentUser._id%>/trial" method="post">
                            <div class="custom-file">
                                <input id="image-selector" name="im"type="file" class="custom-file-input">
                                <label class="custom-file-label" for="image-selector">Choose file</label>
                            </div>
                        <br>
                        <br>
                        <div class="row">
                            <input type="text"name="pred" id="pred" style="display:none;"></input>
                            <button type="submit" id="predict-class" class="btn btn-dark" style=" height:50px; font-size:20px; border-radius:4px;border: none;padding: 12px 16px;color:white;"><i class='fas fa-laptop-medical'></i> Predict</button>
                               </form>
                               <form action="/home/<%=currentUser._id%>/tria" method="post">
                            <button type="button" id="predict-button" class="btn btn-dark" style=" height:50px; font-size:20px; border-radius:4px;border: none;padding: 12px 16px;color:white; display:none;"><i class='fas fa-laptop-medical'></i> Predict</button>
                            </form>
                        </div>
                      
                    </div>
                </div>
                
                <!--</div>-->
                <br>
                <div class="card bg-light text-dark">
                    <div class="card-body">
                        <div class="row">
                            <h2 class="ml-3">Image</h2>
                            <img id="selected-image" name="selectedim" src="" class="mx-auto d-block" style="width:30%" />
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    
<footer class="w3-center w3-black w3-padding-32">

  <a href="#home" class="w3-button w3-light-grey"><i class="fa fa-arrow-up w3-margin-right"></i>To the top</a>
  <p>Powered by <a href="http://www.frcrce.ac.in/" title="W3.CSS" target="_blank" class="w3-hover-text-green">Agnelites</a></p>

</footer>

</div>  

                       
<script>
function hola(obj){
            if(obj == 1 || obj == 2 || obj == 3 ||obj == 4 ) {
            
                    // document.getElementById("Classes").style.visibility="visible";
                    // document.getElementById("Classes").style.display="block";
                    // document.getElementById("Classes1").style.visibility="visible";
                    // document.getElementById("Classes1").style.display="block";
                    // document.getElementById("Classes2").style.visibility="visible";
                    // document.getElementById("Classes2").style.display="block";
                    document.getElementById("fea").style.display="block";
                   document.getElementById("ifr").style.display="block";
                   document.getElementById("if0").style.display="hidden";
                }
            else if(obj==0){
                    document.getElementById("Classes").style.visibility="hidden";
                    document.getElementById("Classes1").style.visibility="hidden";
                    document.getElementById("Classes2").style.visibility="hidden";
                    document.getElementById("if0").style.display="block";
                    document.getElementById("ifr").style.display="hidden";
            }
           
}

function hol(){
     document.getElementById("result").style.display="block";  
    
}
function holw(obj){
            if(obj == 1 || obj == 2 || obj == 3 ||obj == 4 ) {
            document.getElementById("predict-button").style.display="block"; 

            }
    
}

    let base64Image;
    $("#image-selector").change(function() {
        let reader = new FileReader();
        reader.onload = function(e) {
            let dataURL = reader.result;
            $('#selected-image').attr("src", dataURL);
            console.log(dataURL);
            base64Image = dataURL.replace("data:image/png;base64,","");
            console.log(base64Image);
            x=document.getElementById("pred");
            let y=base64Image
           x.setAttribute("value", y);
        }
        //  let file = $("#image-selector").prop("files")[0];
        //  reader.readAsDataURL(file);
         reader.readAsDataURL($("#image-selector")[0].files[0]);
         $("#classes3").text("");
         $("#classes").text("");
         $("#classes1").text("");
         $("#classes2").text("");
         
     
    });
   
    $("#predict-button").click(function(event){
        let message = {
            image: base64Image
        }
        console.log(message);
        $.post("http://3.22.164.166:5000/predict", JSON.stringify(message), function(response){
            // $("#classes3").text(response.resu.result);
            $("#classes").text(response.resu.exudates);
            $("#classes1").text(response.resu.bloodves);
            $("#classes2").text(response.resu.microaneu);
            
           
            console.log(response);
        });
    });
     $("#predict-class").click(function(event){
        let message = {
            image: base64Image
        }
        console.log(message);
       
        $.post("http://3.22.164.166:5000/prediction", JSON.stringify(message), function(response){
            var obj = <%=currentUser.level%>
//             ans = "Your diagnosis : "+obj[1].toString();
            ans = "Level : "+obj.toString();
             hol(); 
            $("#classes3").text(ans);
            
             holw(obj);
            hola(obj);
            
            console.log(response.prediction);
        });
    });
    $(".custom-file-input").on("change", function() {
    var fileName = $(this).val().split("\\").pop();
      $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
function w3_open() {
  document.getElementById("main").style.marginLeft = "25%";
  document.getElementById("mySidebar").style.width = "25%";
  document.getElementById("mySidebar").style.paddingTop = "10%";
  document.getElementById("mySidebar").style.display = "block";
  document.getElementById("openNav").style.display = 'none';
}
function w3_close() {
  document.getElementById("main").style.marginLeft = "0%";
  document.getElementById("mySidebar").style.display = "none";
  document.getElementById("openNav").style.display = "inline-block";
}

</script>
</body>
     
</html>



